<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jordfelsbrytare Test</title>
<meta name="theme-color" content="#f2f2f2">

<style>
/* ------------ Grundlayout ------------ */
body {
    margin: 0;
    padding: 0;
    font-family: "Segoe UI", sans-serif;
    background: #f2f2f2;
    display: flex;
    flex-direction: column;
    height: 100vh;
    overflow: hidden;
}

.topbar {
    padding: 18px;
    font-size: 22px;
    font-weight: bold;
    text-align: center;
    background: #f2f2f2;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}

/* ------------ App-container ------------ */
.app {
    padding: 16px;
    flex: 1;
    overflow-y: auto;
}

.card {
    background: #ffffff;
    padding: 18px;
    border-radius: 14px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
}

label {
    font-weight: 600;
    margin: 12px 0 6px;
    display: block;
    font-size: 16px;
}

select, input {
    width: 100%;
    padding: 14px;
    border-radius: 10px;
    border: 1px solid #ccc;
    font-size: 17px;
}

/* ------------ Spara-knapp alltid synlig ------------ */
.save-wrapper {
    padding: 12px;
    background: #f2f2f2;
    box-shadow: 0 -2px 6px rgba(0,0,0,0.1);
}

.save-btn {
    width: 100%;
    padding: 18px;
    border: none;
    border-radius: 12px;
    font-size: 20px;
    font-weight: bold;
    background: #4CAF50;
    color: white;
}

/* ------------ Modal / Sparat ------------ */
.modal-overlay {
    position: fixed;
    inset: 0;
    display: none;
    align-items: center;
    justify-content: center;
    background: rgba(0,0,0,0.4);
    z-index: 999;
}

.modal-overlay.show {
    display: flex;
}

.modal-box {
    background: white;
    padding: 28px;
    border-radius: 14px;
    text-align: center;
    width: 80%;
    max-width: 300px;
}

.check {
    font-size: 60px;
    color: #4CAF50;
}
</style>
</head>
<body>

<div class="topbar">Jordfelsbrytare Test</div>

<div id="app" class="app">
    <div class="card">

        <label>Uppdrag</label>
        <select id="uppdrag"></select>

        <label>Fastighet</label>
        <select id="fastighet"></select>

        <label>Adress</label>
        <select id="adress"></select>

        <label>L√§genhetsnummer</label>
        <select id="lgh"></select>

        <label>Status</label>
        <select id="status">
            <option value="">V√§lj status‚Ä¶</option>
            <option value="Funktion. OK">Funktion. OK</option>
            <option value="Ej tillg√§nglig">Ej tillg√§nglig</option>
            <option value="Funktionsfel">Funktionsfel</option>
        </select>

    </div>
</div>

<div class="save-wrapper">
    <button class="save-btn" onclick="save()">SPARA</button>
</div>

<!-- Modal -->
<div id="savedModal" class="modal-overlay">
    <div class="modal-box">
        <div class="check">‚úì</div>
        <p style="font-size:20px;font-weight:bold;">Sparat!</p>
    </div>
</div>

<!-- Pling-ljud -->
<audio id="pling" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>

<script>
/* -------------------------------------------------- */
/* --------------------- DATA ----------------------- */
/* -------------------------------------------------- */

const API_URL = "YOUR_WEBAPP_URL_HERE";   // <<< BYT UT DENNA

let allData = [];

/* -------------------------------------------------- */
/* ----------------- H√ÑMTA DATA ---------------------- */
/* -------------------------------------------------- */

async function loadData() {
    try {
        const res = await fetch(API_URL);
        const json = await res.json();
        allData = json.data || [];

        fill("uppdrag", [...new Set(allData.map(i => i.uppdrag).filter(Boolean))]);
        fill("fastighet", [...new Set(allData.map(i => i.fastighet).filter(Boolean))]);
        fill("adress", [...new Set(allData.map(i => i.adress).filter(Boolean))]);
        fill("lgh", [...new Set(allData.map(i => i.lgh).filter(Boolean))]);

    } catch (e) {
        alert("Fel vid h√§mtning av data");
        console.error(e);
    }
}

function fill(id, arr) {
    const sel = document.getElementById(id);
    sel.innerHTML = "<option value=''>V√§lj‚Ä¶</option>";
    arr.forEach(v => {
        const o = document.createElement("option");
        o.value = v;
        o.textContent = v;
        sel.appendChild(o);
    });
}

/* -------------------------------------------------- */
/* ----------------- SPARA DATA --------------------- */
/* -------------------------------------------------- */

async function save() {
    const data = {
        uppdrag: uppdrag.value,
        fastighet: fastighet.value,
        adress: adress.value,
        lgh: lgh.value,
        status: status.value
    };

    if (Object.values(data).includes("")) {
        alert("Alla f√§lt m√•ste fyllas i!");
        return;
    }

    // üîî Pling
    document.getElementById("pling").play();

    // üì≥ Vibration
    if (navigator.vibrate) navigator.vibrate([80, 40, 80]);

    try {
        await fetch(API_URL, {
            method: "POST",
            body: JSON.stringify(data)
        });

        showSaved();

        uppdrag.value = "";
        fastighet.value = "";
        adress.value = "";
        lgh.value = "";
        status.value = "";

    } catch (e) {
        console.error(e);
        alert("Fel vid sparning");
    }
}

/* -------------------------------------------------- */
/* -------------------- MODAL ------------------------ */
/* -------------------------------------------------- */

function showSaved() {
    const m = document.getElementById("savedModal");
    m.classList.add("show");
    setTimeout(() => m.classList.remove("show"), 1500);
}

loadData();
</script>
</body>
</html>